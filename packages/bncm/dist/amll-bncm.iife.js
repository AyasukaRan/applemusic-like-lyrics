(function(){"use strict";const m=".test{color:#fff}";function b(...t){({}).AMLL_DEV&&console.log("%c[AMLL]","color:#2AF",...t)}function h(...t){({}).AMLL_DEV&&console.log("%c[AMLL] %c[WARN]","color:#2AF","color:#F82",...t)}const a=47,u=46,A=t=>{const n=typeof t;if(n!=="string")throw new TypeError(`Expected a string, got a ${n}`)},F=(t,n)=>{let e="",s=0,i=-1,c=0,l;for(let o=0;o<=t.length;++o){if(o<t.length)l=t.charCodeAt(o);else{if(l===a)break;l=a}if(l===a){if(!(i===o-1||c===1))if(i!==o-1&&c===2){if(e.length<2||s!==2||e.charCodeAt(e.length-1)!==u||e.charCodeAt(e.length-2)!==u){if(e.length>2){const f=e.lastIndexOf("/");if(f!==e.length-1){f===-1?(e="",s=0):(e=e.slice(0,f),s=e.length-1-e.lastIndexOf("/")),i=o,c=0;continue}}else if(e.length===2||e.length===1){e="",s=0,i=o,c=0;continue}}n&&(e.length>0?e+="/..":e="..",s=2)}else e.length>0?e+=`/${t.slice(i+1,o)}`:e=t.slice(i+1,o),s=o-i-1;i=o,c=0}else l===u&&c!==-1?++c:c=-1}return e},L=t=>{try{return decodeURIComponent(t)}catch{return t}},g=t=>{A(t);let n=t.replaceAll("\\","/");if(n.length===0)return".";const e=n.charCodeAt(0)===a,s=n.charCodeAt(n.length-1)===a;return n=L(n),n=F(n,!e),n.length===0&&!e&&(n="."),n.length>0&&s&&(n+="/"),e?`/${n}`:n};function w(){const t=document.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=m,document.head.appendChild(t)}async function y(){const t=betterncm.utils.debounce(()=>(betterncm_native?.app?.restart??betterncm.reload??location.reload)(),1e3),n=["/manifest.json","/amll-bncm.iife.js"],e=new Map;for(const l of n)e.set(l,await betterncm.fs.readFileText(plugin.pluginPath+l));const s=g(plugin.pluginPath);for(const l of await betterncm.fs.readDir(plugin.pluginPath)){const o=g(l).replace(s,"");e.set(o,await betterncm.fs.readFileText(l))}async function i(l){const o=await betterncm.fs.readFileText(plugin.pluginPath+l);e.get(l)!==o&&(e.set(l,o),n.includes(l)&&(h("检测到",l,"更新 (",e.get(l)?.length,"->",o.length,")正在重载"),t()))}const c=new Map;betterncm_native?.fs?.watchDirectory(plugin.pluginPath,(l,o)=>{const f=g(l),r=g(`${l}/${o}`).replace(f,"");c.has(r)||c.set(r,betterncm.utils.debounce(()=>i(r),1e3));const d=c.get(r);if(d)d();else{const p=betterncm.utils.debounce(()=>i(r),1e3);c.set(r,p),p()}}),b("已启用开发重载功能！")}plugin.onLoad(async()=>{w(),console.log("%cApple Music-like Lyrics%c for %cBetterNCM","color:#2AF;font-weight:bold;","color:#FFF;font-weight:normal;","color:#F8878A;font-weight:bold;"),{}.AMLL_DEV&&(h("正在以开发模式运行插件！"),y())})})();
//# sourceMappingURL=amll-bncm.iife.js.map
