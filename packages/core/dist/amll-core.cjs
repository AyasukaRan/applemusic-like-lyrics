"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const G=require("@pixi/display"),Q=require("@pixi/app"),v=require("@pixi/filter-blur"),k=require("@pixi/filter-color-matrix"),j=require("@pixi/core"),B=require("@pixi/sprite"),A=require("@pixi/filter-bulge-pinch"),K=require("jss"),Z=require("jss-preset-default");class W{}class q extends W{constructor(e){super(),this.canvas=e,this.observer=new ResizeObserver(()=>{const i=e.getBoundingClientRect(),t=Math.max(1,i.width*window.devicePixelRatio*this.currerntRenderScale),s=Math.max(1,i.height*window.devicePixelRatio*this.currerntRenderScale);this.onResize(t,s)}),this.observer.observe(e)}observer;flowSpeed=2;currerntRenderScale=.75;setRenderScale(e){this.currerntRenderScale=e;const i=this.canvas.getBoundingClientRect();this.onResize(i.width*window.devicePixelRatio*this.currerntRenderScale,i.height*window.devicePixelRatio*this.currerntRenderScale)}onResize(e,i){this.canvas.width=e,this.canvas.height=i}setFlowSpeed(e){this.flowSpeed=e}dispose(){this.observer.disconnect(),this.canvas.remove()}}class J extends G.Container{time=0}class ee extends q{constructor(e){super(e),this.canvas=e,this.app=new Q.Application({view:e,resizeTo:this.canvas,powerPreference:"low-power",backgroundAlpha:1}),this.rebuildFilters(),this.app.ticker.maxFPS=30,this.app.ticker.add(this.onTick),this.app.ticker.start()}app;curContainer;staticMode=!1;lastContainer=new Set;onTick=e=>{for(const i of this.lastContainer)i.alpha=Math.max(0,i.alpha-e/60),i.alpha<=0&&(this.app.stage.removeChild(i),this.lastContainer.delete(i),i.destroy(!0));if(this.curContainer){this.curContainer.alpha=Math.min(1,this.curContainer.alpha+e/60);const[i,t,s,l]=this.curContainer.children,r=Math.max(this.app.screen.width,this.app.screen.height);i.position.set(this.app.screen.width/2,this.app.screen.height/2),t.position.set(this.app.screen.width/2.5,this.app.screen.height/2.5),s.position.set(this.app.screen.width/2,this.app.screen.height/2),l.position.set(this.app.screen.width/2,this.app.screen.height/2),i.width=r*Math.sqrt(2),i.height=i.width,t.width=r*.8,t.height=t.width,s.width=r*.5,s.height=s.width,l.width=r*.25,l.height=l.width,this.curContainer.time+=e*this.flowSpeed,i.rotation+=e/1e3*this.flowSpeed,t.rotation-=e/500*this.flowSpeed,s.rotation+=e/1e3*this.flowSpeed,l.rotation-=e/750*this.flowSpeed,s.x=this.app.screen.width/2+this.app.screen.width/4*Math.cos(this.curContainer.time/1e3*.75),s.y=this.app.screen.height/2+this.app.screen.width/4*Math.cos(this.curContainer.time/1e3*.75),l.x=this.app.screen.width/2+this.app.screen.width/4*.1+Math.cos(this.curContainer.time*.006*.75),l.y=this.app.screen.height/2+this.app.screen.width/4*.1+Math.cos(this.curContainer.time*.006*.75),this.curContainer.alpha>=1&&this.lastContainer.size===0&&this.staticMode&&this.app.ticker.stop()}};onResize(e,i){super.onResize(e,i),this.app.resize(),this.rebuildFilters()}setRenderScale(e){super.setRenderScale(e),this.rebuildFilters()}rebuildFilters(){const e=Math.min(this.canvas.width,this.canvas.height),i=Math.max(this.canvas.width,this.canvas.height),t=new k.ColorMatrixFilter;t.saturate(1.2,!1);const s=new k.ColorMatrixFilter;s.brightness(.6,!1);const l=new k.ColorMatrixFilter;l.contrast(.3,!0),this.app.stage.filters?.forEach(r=>{r.destroy()}),this.app.stage.filters=[],this.app.stage.filters.push(new v.BlurFilter(5,1)),this.app.stage.filters.push(new v.BlurFilter(10,1)),this.app.stage.filters.push(new v.BlurFilter(20,2)),this.app.stage.filters.push(new v.BlurFilter(40,2)),this.app.stage.filters.push(new v.BlurFilter(80,2)),e>768&&this.app.stage.filters.push(new v.BlurFilter(160,4)),e>768*2&&this.app.stage.filters.push(new v.BlurFilter(320,4)),this.app.stage.filters.push(t,s,l),this.app.stage.filters.push(new v.BlurFilter(5,1)),Math.random()>.5?(this.app.stage.filters.push(new A.BulgePinchFilter({radius:(i+e)/2,strength:1,center:[.25,1]})),this.app.stage.filters.push(new A.BulgePinchFilter({radius:(i+e)/2,strength:1,center:[.75,0]}))):(this.app.stage.filters.push(new A.BulgePinchFilter({radius:(i+e)/2,strength:1,center:[.75,1]})),this.app.stage.filters.push(new A.BulgePinchFilter({radius:(i+e)/2,strength:1,center:[.25,0]})))}setStaticMode(e=!1){this.staticMode=e,this.app.ticker.start()}setFPS(e){this.app.ticker.maxFPS=e}pause(){this.app.ticker.stop(),this.app.render()}resume(){this.app.ticker.start()}setLowFreqVolume(e){}setHasLyric(e){}async setAlbumImage(e){if(e.trim().length===0)return;const i=new Image;i.src=e,i.crossOrigin="anonymous";let t=5,s;for(;!s?.baseTexture?.resource?.valid&&t>0;)try{await i.decode(),s=j.Texture.from(i,{resourceOptions:{autoLoad:!1}}),await s.baseTexture.resource.load()}catch(h){console.warn(`failed on loading album image, retrying (${t})`,e,h),s=void 0,t--}if(!s)return;const l=new J,r=new B.Sprite(s),n=new B.Sprite(s),o=new B.Sprite(s),a=new B.Sprite(s);r.anchor.set(.5,.5),n.anchor.set(.5,.5),o.anchor.set(.5,.5),a.anchor.set(.5,.5),r.rotation=Math.random()*Math.PI*2,n.rotation=Math.random()*Math.PI*2,o.rotation=Math.random()*Math.PI*2,a.rotation=Math.random()*Math.PI*2,l.addChild(r,n,o,a),this.curContainer&&this.lastContainer.add(this.curContainer),this.curContainer=l,this.app.stage.addChild(l),this.curContainer.alpha=0,this.app.ticker.start()}dispose(){super.dispose(),this.app.ticker.remove(this.onTick),this.app.destroy(!0)}getElement(){return this.canvas}}var _=`#version 300 es
precision highp float;in vec2 v_coord;out vec2 f_v_coord;void main(){gl_Position=vec4(v_coord,0.0f,1.0f);f_v_coord=(vec2(v_coord.x,v_coord.y)+vec2(1.0f,1.0f))/2.0f;}`,te=`#version 300 es
precision highp float;uniform sampler2D src;in vec2 f_v_coord;out vec4 fragColor;void main(){vec2 coord=f_v_coord;fragColor=texture(src,coord);}`,ie=`#version 300 es
precision highp float;uniform sampler2D src;uniform float lerp;uniform float scale;in vec2 f_v_coord;out vec4 fragColor;void main(){vec2 tex_coord=f_v_coord;if(scale<1.0f){tex_coord/=scale;}vec4 srcColor=texture(src,tex_coord);fragColor=mix(vec4(srcColor.xyz,0.0f),srcColor,lerp);}`,se=`#version 300 es
precision highp float;uniform float IIIlllllllIIIllIl,lIIIlllllIllIl,IIIlllIlIIllll;uniform sampler2D IlllIIlIlllIll;uniform vec2 IIlIlIIlIlIllI;out vec4 lIIlIIIIIlIlIlllIIIIlIIl;mat2 rotate2d(float _angle){return mat2(cos(_angle),-sin(_angle),sin(_angle),cos(_angle));}float IllllIIlIllII(float llIIllIllIIIllI){return fract(sin(llIIllIllIIIllI)*43758.5453);}float llIlIIllllIII(vec2 IIIlIIlIIIlllIII){vec2 IIllIlIIlllI=floor(IIIlIIlIIIlllIII),lIlIllIIIIIlIl=fract(IIIlIIlIIIlllIII);lIlIllIIIIIlIl=lIlIllIIIIIlIl*lIlIllIIIIIlIl*(3.-2.*lIlIllIIIIIlIl);float lIlIlIlIlIlIIl=IIllIlIIlllI.x+IIllIlIIlllI.y*57.;return mix(mix(IllllIIlIllII(lIlIlIlIlIlIIl),IllllIIlIllII(lIlIlIlIlIlIIl+1.),lIlIllIIIIIlIl.x),mix(IllllIIlIllII(lIlIlIlIlIlIIl+57.),IllllIIlIllII(lIlIlIlIlIlIIl+58.),lIlIllIIIIIlIl.x),lIlIllIIIIIlIl.y);}vec2 lllIIIIIIllIlIIIlI(vec2 IlllIIlIIIIlIIII,float lIIIIlllIIIIllIlIlI,vec2 IlIlIIIIlIlllIlIII){float lIIlIllIIIlIl=llIlIIllllIII(IlllIIlIIIIlIIII*1.5+sin(.1*lIIIlllllIllIl))*3.2831;IlllIIlIIIIlIIII+=vec2(.1,.5);lIIlIllIIIlIl+=llIlIIllllIII(IlllIIlIIIIlIIII*vec2(1.5,1.)*3.5-sin(.1*lIIIlllllIllIl))*2.2831*IIIlllllllIIIllIl;lIIlIllIIIlIl-=lIIIIlllIIIIllIlIlI;return vec2(cos(lIIlIllIIIlIl),sin(lIIlIllIIIlIl));}const float overlap=0.2;const float rgOverlap=0.1*overlap;const float rbOverlap=0.01*overlap;const float gbOverlap=0.04*overlap;const mat3 coneOverlap=mat3(1.0,rgOverlap,rbOverlap,rgOverlap,1.0,gbOverlap,rbOverlap,rgOverlap,1.0);const mat3 coneOverlapInverse=mat3(1.0+(rgOverlap+rbOverlap),-rgOverlap,-rbOverlap,-rgOverlap,1.0+(rgOverlap+gbOverlap),-gbOverlap,-rbOverlap,-rgOverlap,1.0+(rbOverlap+rgOverlap));vec3 tonemap(vec3 color){color=color*coneOverlap;const float p=3.0;color=pow(color,vec3(p));color=color/(1.0+color);color=pow(color,vec3(1.0/p));color=color*coneOverlapInverse;color=clamp(color,vec3(0.0),vec3(1.0));return color;}void main(){vec2 lIIIlIIllIlIIlI=gl_FragCoord.xy/IIlIlIIlIlIllI.xy,lIIllIIlIIIllI=lIIIlIIllIlIIlI*.8f+vec2(-.1f,.2f);lIIllIIlIIIllI.x*=IIlIlIIlIlIllI.x/IIlIlIIlIlIllI.y;float lIIlIIlIIlIIIlII=lIIIlllllIllIl*.01f+gl_FragCoord.x/max(IIlIlIIlIlIllI.x,IIlIlIIlIlIllI.y),lIIIlIllIllIlIIl=0.f;vec3 lIIIlIlIIIlIlIIl=texture(IlllIIlIlllIll,lIIllIIlIIIllI*rotate2d(lIIIlllllIllIl*.4)).xyz;vec2 lIlIIlIlIIIllIll=lIIllIIlIIIllI;for(int IllIlIIlIIlllllIIIl=0;IllIlIIlIIlllllIIIl<8;IllIlIIlIIlllllIIIl++){vec2 lIllIIlIIlIIIll=lllIIIIIIllIlIIIlI(lIIllIIlIIIllI,lIIlIIlIIlIIIlII,lIIIlIIllIlIIlI);float lIIlIlIIlIIlIllI=float(IllIlIIlIIlllllIIIl)/16.f,lIIllIIlIIIIlIII=4.f*lIIlIlIIlIIlIllI*(1.f-lIIlIlIIlIIlIllI);vec3 llIIlIIIIlIIlIII=lIIllIIlIIIIlIII*texture(IlllIIlIlllIll,lIIllIIlIIIllI*rotate2d(lIIIlllllIllIl*.4)+IIIlllIlIIllll*.2*(IllIlIIlIIlllllIIIl%2==0?-1.:1.)).xyz;lIIIlIlIIIlIlIIl+=lIIllIIlIIIIlIII*llIIlIIIIlIIlIII;lIIIlIllIllIlIIl+=lIIllIIlIIIIlIII;lIIllIIlIIIllI+=.05f*lIllIIlIIlIIIll;lIlIIlIlIIIllIll+=.01f*lIllIIlIIlIIIll;}lIIIlIlIIIlIlIIl/=lIIIlIllIllIlIIl;vec2 IIlllIIlIllIIlI=lllIIIIIIllIlIIIlI(lIlIIlIlIIIllIll,lIIlIIlIIlIIIlII,lIIIlIIllIlIIlI);lIIIlIlIIIlIlIIl*=.2f+.8f*pow(2.f*lIIIlIIllIlIIlI.x*(1.f-lIIIlIIllIlIIlI.x),.1f);lIIIlIlIIIlIlIIl*=2.8f;lIIIlIlIIIlIlIIl=1.f-exp(-lIIIlIlIIIlIlIIl);lIIIlIlIIIlIlIIl=pow(lIIIlIlIIIlIlIIl,vec3(2.2));lIIIlIlIIIlIlIIl*=.9f;lIIIlIlIIIlIlIIl=tonemap(lIIIlIlIIIlIlIIl);lIIlIIIIIlIlIlllIIIIlIIl=vec4(lIIIlIlIIIlIlIIl,1);}`,re=`#version 300 es
precision highp float;uniform sampler2D src;uniform sampler2D lastsrc;uniform vec2 texSize;in vec2 f_v_coord;out vec4 fragColor;vec4 smartDeNoise(sampler2D tex,vec2 uv,float radius,float threshold){float radQ=radius*radius;vec4 centrPx=texture(tex,uv);float zBuff=0.0f;vec4 aBuff=vec4(0.0f);vec2 size=vec2(textureSize(tex,0));for(float x=-radius;x<=radius;x++){float pt=sqrt(radQ-x*x);for(float y=-pt;y<=pt;y++){vec2 d=vec2(x,y);vec4 walkPx=texture(tex,uv+d/size);vec4 dC=walkPx-centrPx;float deltaFactor=exp(-dot(dC,dC)*threshold);zBuff+=deltaFactor;aBuff+=deltaFactor*walkPx;}}return aBuff/zBuff;}void main(){fragColor=texture(src,f_v_coord);}/*
#define INV_SQRT_OF_2PI 0.39894228040143267793994605993439
#define INV_PI 0.31830988618379067153776752674503
vec4 smartDeNoise(sampler2D tex,vec2 uv,float sigma,float kSigma,float threshold){float radius=round(kSigma*sigma);float radQ=radius*radius;float invSigmaQx2=.5/(sigma*sigma);float invSigmaQx2PI=INV_PI*invSigmaQx2;float invThresholdSqx2=.5/(threshold*threshold);float invThresholdSqrt2PI=INV_SQRT_OF_2PI/threshold;vec4 centrPx=texture(tex,uv);float zBuff=0.0;vec4 aBuff=vec4(0.0);vec2 size=vec2(textureSize(tex,0));vec2 d;for(d.x=-radius;d.x<=radius;d.x++){float pt=sqrt(radQ-d.x*d.x);for(d.y=-pt;d.y<=pt;d.y++){float blurFactor=exp(-dot(d,d)*invSigmaQx2)*invSigmaQx2PI;vec4 walkPx=texture(tex,uv+d/size);vec4 dC=walkPx-centrPx;float deltaFactor=exp(-dot(dC,dC)*invThresholdSqx2)*invThresholdSqrt2PI*blurFactor;zBuff+=deltaFactor;aBuff+=deltaFactor*walkPx;}}return aBuff/zBuff;}void main(){fragColor=smartDeNoise(src,f_v_coord,5.,2.,.005);}*/`,le=`#version 300 es
precision highp float;uniform sampler2D src;uniform float frameTime;uniform float scale;in vec2 f_v_coord;out vec4 fragColor;float nrand(vec2 n){return fract(sin(dot(n.xy,vec2(12.9898f,78.233f)))*43758.5453f);}vec3 nrand3(vec2 n){return vec3(nrand(n),nrand(n+vec2(0.15f)),nrand(n+vec2(0.3f)));}float blur_radius=0.035f;void main(){vec2 tex_coord=f_v_coord;if(scale<1.0f){tex_coord/=scale;}
#if 1
float nrnd=(nrand(f_v_coord)-0.5f)/256.0f;vec3 nrnd3=(nrand3(f_v_coord)-vec3(0.5f))/256.0f;vec4 color=texture(src,tex_coord);int count=0;vec3 sampled_color=vec3(0.0f);for(float i=-2.f;i<=2.f;i+=1.f){for(float j=-2.f;j<=2.f;j+=1.f){vec2 offset=fract(vec2(0.61803398875f,0.38196601125f)*1.f+nrand3(tex_coord+frameTime).xy)+vec2(sin(i),cos(j))/256.f-0.5f;sampled_color+=textureLod(src,blur_radius*offset+tex_coord,3.0f).xyz;count++;}}sampled_color/=vec3(count);vec3 deviation=sampled_color-color.rgb;deviation=max(vec3(0.0f),sqrt(deviation*deviation));bvec3 blend_factor=lessThan(deviation,vec3(0.02945917622f));color.rgb=mix(color.rgb,sampled_color,vec3(blend_factor));fragColor=color;
#else
float nrnd=(nrand(tex_coord)-0.5f)/256.0f;vec3 nrnd3=(nrand3(tex_coord)-vec3(0.5f))/256.0f;vec4 color=texture(src,tex_coord);vec2 offset=fract(vec2(0.61803398875f,0.38196601125f)*1.f+nrand3(tex_coord+frameTime).xy)-0.5f;vec3 sampled_color=textureLod(src,blur_radius*offset+tex_coord,3.0f).xyz;vec3 deviation=sampled_color-color.rgb;deviation=max(vec3(0.0f),sqrt(deviation*deviation));bvec3 blend_factor=lessThan(deviation,vec3(0.02945917622f));color.rgb=mix(color.rgb,sampled_color,vec3(blend_factor));fragColor=color;
#endif
}`;function ne(c,e,i){const t=c.data,s=c.width,l=c.height;let r,n,o,a,h,d,f,u,I,m,g,p,y;const x=s-1,N=l-1,S=e+1,Y=e+S,b=e+1,V=e+b,z=1/(Y*V),E=[],L=[],w=[],P=[],F=[],C=[];for(;i-- >0;){for(y=p=0,d=0;d<l;d++){for(r=t[y]*S,n=t[y+1]*S,o=t[y+2]*S,a=t[y+3]*S,f=1;f<=e;f++)u=y+((f>x?x:f)<<2),r+=t[u++],n+=t[u++],o+=t[u++],a+=t[u];for(h=0;h<s;h++)E[p]=r,L[p]=n,w[p]=o,P[p]=a,d===0&&(F[h]=Math.min(h+S,x)<<2,C[h]=Math.max(h-e,0)<<2),I=y+F[h],m=y+C[h],r+=t[I++]-t[m++],n+=t[I++]-t[m++],o+=t[I++]-t[m++],a+=t[I]-t[m],p++;y+=s<<2}for(h=0;h<s;h++){for(g=h,r=E[g]*b,n=L[g]*b,o=w[g]*b,a=P[g]*b,f=1;f<=e;f++)g+=f>N?0:s,r+=E[g],n+=L[g],o+=w[g],a+=P[g];for(p=h<<2,d=0;d<l;d++)t[p]=r*z+.5|0,t[p+1]=n*z+.5|0,t[p+2]=o*z+.5|0,t[p+3]=a*z+.5|0,h===0&&(F[d]=Math.min(d+b,N)*s,C[d]=Math.max(d-e,0)*s),I=h+F[d],m=h+C[d],r+=E[I]-E[m],n+=L[I]-L[m],o+=w[I]-w[m],a+=P[I]-P[m],p+=s<<2}}}function ae(c,e){const i=c.data;for(let t=0;t<i.length;t+=4){const s=i[t],l=i[t+1],r=i[t+2],n=i[t+3],o=s*.3+l*.59+r*.11;i[t]=o*(1-e)+s*e,i[t+1]=o*(1-e)+l*e,i[t+2]=o*(1-e)+r*e,i[t+3]=n}}function oe(c,e){const i=c.data;for(let t=0;t<i.length;t+=4){const s=i[t],l=i[t+1],r=i[t+2],n=i[t+3];i[t]=(s-128)*e+128,i[t+1]=(l-128)*e+128,i[t+2]=(r-128)*e+128,i[t+3]=n}}class R{gl;program;vertexShader;fragmentShader;coordPos;constructor(e,i,t){this.gl=e,this.vertexShader=this.createShader(e.VERTEX_SHADER,i),this.fragmentShader=this.createShader(e.FRAGMENT_SHADER,t),this.program=this.createProgram();const s=e.getAttribLocation(this.program,"v_coord");if(s===-1)throw new Error("Failed to get attribute location v_coord");this.coordPos=s}createShader(e,i){const t=this.gl,s=t.createShader(e);if(!s)throw new Error("Failed to create shader");if(t.shaderSource(s,i),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw new Error(`Failed to compile shader for type ${e}: ${t.getShaderInfoLog(s)}`);return s}createProgram(){const e=this.gl,i=e.createProgram();if(!i)throw new Error("Failed to create program");if(e.attachShader(i,this.vertexShader),e.attachShader(i,this.fragmentShader),e.linkProgram(i),e.validateProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){const t=e.getProgramInfoLog(i);throw e.deleteProgram(i),new Error(`Failed to link program: ${t}`)}return i}use(){const e=this.gl;e.useProgram(this.program),e.vertexAttribPointer(this.coordPos,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(this.coordPos)}setUniform1f(e,i){const t=this.gl,s=t.getUniformLocation(this.program,e);s?t.uniform1f(s,i):console.warn(`Failed to get uniform location: ${e}`)}setUniform2f(e,i,t){const s=this.gl,l=s.getUniformLocation(this.program,e);l?s.uniform2f(l,i,t):console.warn(`Failed to get uniform location: ${e}`)}setUniform1i(e,i){const t=this.gl,s=t.getUniformLocation(this.program,e);s?t.uniform1i(s,i):console.warn(`Failed to get uniform location: ${e}`)}dispose(){const e=this.gl;e.deleteShader(this.vertexShader),e.deleteShader(this.fragmentShader),e.deleteProgram(this.program)}}class O{constructor(e,i,t){this.gl=e,this._size=[i,t];const s=e.createFramebuffer();if(!s)throw new Error("Can't create framebuffer");const l=e.createTexture();if(!l)throw new Error("Failed to create texture");this.fb=s,this.tex=l,this.resize(i,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT)}fb;tex;_size;get size(){return this._size}resize(e,i){const t=this.gl;this.bind(),t.bindTexture(t.TEXTURE_2D,this.tex),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,i,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.MIRRORED_REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.MIRRORED_REPEAT)}bind(){const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.fb),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.tex,0)}active(e=this.gl.TEXTURE0){this.gl.activeTexture(e),this.gl.bindTexture(this.gl.TEXTURE_2D,this.tex)}dispose(){this.gl.deleteFramebuffer(this.fb)}}class ${gl;buffer;type;data;usage;length;constructor(e,i,t,s){this.gl=e,this.type=i,this.data=t,this.usage=s;const l=e.createBuffer();if(!l)throw new Error("Failed to create buffer");this.buffer=l,this.length=t.byteLength,e.bindBuffer(i,this.buffer),e.bufferData(i,t,s)}bind(){this.gl.bindBuffer(this.type,this.buffer)}dispose(){this.gl.deleteBuffer(this.buffer)}}class he{constructor(e,i,t,s,l){this.gl=e,this.mainProgram=i,this.vertexBuffer=t,this.indexBuffer=s;const r=e.createTexture();if(!r)throw new Error("Failed to create texture");this.albumTexture=r,e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,l),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT)}albumTexture;alpha=0;draw(e){const i=this.gl;this.mainProgram.use(),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.albumTexture),this.mainProgram.setUniform1i(e,0),i.drawArrays(i.TRIANGLE_STRIP,0,4)}dispose(){this.gl.deleteTexture(this.albumTexture)}}class D extends q{constructor(e){super(e),this.canvas=e;const i=this.gl;i.enable(this.gl.BLEND),i.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.requestTick();const t=e.getBoundingClientRect(),s=t.width*window.devicePixelRatio*this.currerntRenderScale,l=t.height*window.devicePixelRatio*this.currerntRenderScale;this.fb=[new O(this.gl,s,l),new O(this.gl,s,l)],this.historyFrameBuffer=new Array(5).fill(0).map(()=>new O(this.gl,s,l)),this.fb.forEach(r=>{r.bind(),i.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)}),this.onResize(s,l)}hasLyric=!0;hasLyricValue=1;maxFPS=30;lastTickTime=0;lastFrameTime=0;_lowFreqVolume=1;paused=!1;staticMode=!1;gl=this.setupGL();reduceImageSizeCanvas=new OffscreenCanvas(64,64);tickHandle=0;sprites=[];ampTransition=0;playTime=0;frameTime=0;onTick(e){if(this.tickHandle=0,this.paused)return;const i=e-this.lastTickTime,t=e-this.lastFrameTime;if(this.lastFrameTime=e,i<1e3/this.maxFPS){this.requestTick();return}this.hasLyric&&(this.playTime+=t*this.flowSpeed*.2),this.frameTime+=t,this.onRedraw(this.playTime,t)&&this.staticMode||this.requestTick(),this.lastTickTime=e,this.ampTransition}mainProgram=new R(this.gl,_,se);blendProgram=new R(this.gl,_,ie);copyProgram=new R(this.gl,_,te);taaProgram=new R(this.gl,_,re);noiseProgram=new R(this.gl,_,le);static rawVertexBuffer=new Float32Array([-1,-1,1,-1,-1,1,1,1]);static rawIndexBuffer=new Uint16Array([0,1,2,1,2,3]);vertexBuffer=new $(this.gl,this.gl.ARRAY_BUFFER,D.rawVertexBuffer,this.gl.STATIC_DRAW);indexBuffer=new $(this.gl,this.gl.ELEMENT_ARRAY_BUFFER,D.rawIndexBuffer,this.gl.STATIC_DRAW);fb;historyFrameBuffer=[];_currentSize=[0,0];_targetSize=[0,0];pixelSize=[0,0];renderSize=[0,0];onResize(e,i){this._targetSize=[e,i]}checkResize(){if(this._currentSize[0]===this._targetSize[0]&&this._currentSize[1]===this._targetSize[1])return;this._currentSize=[...this._targetSize];const[e,i]=this._targetSize,t=Math.max(e/this.currerntRenderScale,e),s=Math.max(i/this.currerntRenderScale,i);this.renderSize=[e,i],this.canvas.width=t,this.canvas.height=s,this.pixelSize=[t,s],this.gl.viewport(0,0,t,s);for(const l of this.fb)l.resize(e,i);for(const l of this.historyFrameBuffer)l.resize(t,s)}requestTick(){this.tickHandle||(this.tickHandle=requestAnimationFrame(e=>this.onTick(e)))}drawScreen(){this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}bindDefaultFrameBuffer(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}onRedraw(e,i){this.checkResize(),this.hasLyricValue=(this.hasLyricValue*19+(this.hasLyric?1:0))/20;const t=this.gl;this.vertexBuffer.bind(),this.indexBuffer.bind(),this.mainProgram.use(),this.mainProgram.setUniform2f("IIlIlIIlIlIllI",this.renderSize[0],this.renderSize[1]),this.mainProgram.setUniform1f("lIIIlllllIllIl",e/1e3),this.mainProgram.setUniform1f("IIIlllllllIIIllIl",this.hasLyricValue),this.mainProgram.setUniform1f("IIIlllIlIIllll",this.hasLyric?this._lowFreqVolume:0);const[s,l]=this.fb;l.bind(),t.clearColor(0,0,0,0),t.clear(this.gl.COLOR_BUFFER_BIT);for(const n of this.sprites)s.bind(),t.clearColor(0,0,0,0),t.clear(this.gl.COLOR_BUFFER_BIT),this.mainProgram.use(),n.draw("IlllIIlIlllIll"),l.bind(),this.blendProgram.use(),s.active(),this.blendProgram.setUniform1i("src",0),this.blendProgram.setUniform1f("lerp",n.alpha),this.blendProgram.setUniform1f("scale",this.currerntRenderScale),this.drawScreen(),n.alpha=Math.min(1,n.alpha+i/200);this.noiseProgram.use(),this.noiseProgram.setUniform1f("scale",this.currerntRenderScale),this.noiseProgram.setUniform1f("frameTime",this.frameTime/1e7),this.noiseProgram.setUniform2f("renderSize",this.renderSize[0],this.renderSize[1]),s.bind(),l.active(),this.blendProgram.setUniform1i("src",0),this.drawScreen();const r=this.historyFrameBuffer.pop();if(r?(r.bind(),this.copyFrameBuffer(s,r),this.taaProgram.use(),this.taaProgram.setUniform1f("scale",this.currerntRenderScale),this.taaProgram.setUniform1f("frameTime",this.frameTime),this.taaProgram.setUniform2f("renderSize",this.renderSize[0],this.renderSize[1]),this.historyFrameBuffer.forEach((n,o)=>{n.active(t.TEXTURE0+o+1),this.taaProgram.setUniform1i(`historyFrame${o}`,o+1)}),this.drawScreen(),this.copyFrameBuffer(r,null),this.historyFrameBuffer.unshift(r)):this.copyFrameBuffer(s,null),this.sprites.length>1&&this.sprites[this.sprites.length-1].alpha>=1)for(const o of this.sprites.splice(0,this.sprites.length-1))o.dispose();return this.sprites.length===1&&this.sprites[0].alpha>=1}copyFrameBuffer(e,i=null){e!==i&&(e.active(this.gl.TEXTURE0),this.copyProgram.use(),i?i.bind():this.bindDefaultFrameBuffer(),this.copyProgram.setUniform1i("src",0),this.drawScreen())}setupGL(){const e=this.canvas.getContext("webgl2",{alpha:!0,depth:!1,powerPreference:"low-power"});if(!e)throw new Error("WebGL2 not supported");return this.gl=e,e.enable(e.BLEND),e.disable(e.DEPTH_TEST),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e}setLowFreqVolume(e){this._lowFreqVolume=e}setStaticMode(e){this.staticMode=e,this.lastFrameTime=performance.now(),this.requestTick()}setFPS(e){this.maxFPS=e}pause(){this.tickHandle&&(cancelAnimationFrame(this.tickHandle),this.tickHandle=0),this.paused=!0}resume(){this.paused=!1,this.requestTick()}loadImage(e){return new Promise((i,t)=>{const s=document.createElement("img");s.onload=()=>i(s),s.onerror=t,s.src=e,s.crossOrigin="anonymous"})}async setAlbumImage(e){if(e.trim().length===0)return;let i=5,t=null;for(;!t&&i>0;)try{t=await this.loadImage(e)}catch(d){console.warn(`failed on loading album image, retrying (${i})`,e,d),i--}if(!t)return;const s=this.reduceImageSizeCanvas,l=s.getContext("2d");if(!l)throw new Error("Failed to create canvas context");l.clearRect(0,0,s.width,s.height);const r=4,n=t.naturalWidth,o=t.naturalHeight;l.drawImage(t,0,0,n,o,0,0,s.width,s.height);const a=l.getImageData(0,0,s.width,s.height);oe(a,.8),ae(a,1.5),ne(a,r,4);const h=new he(this.gl,this.mainProgram,this.vertexBuffer,this.indexBuffer,a);this.sprites.push(h),this.hasLyric?this.playTime=9e4:this.playTime=0,this.lastFrameTime=performance.now(),this.requestTick()}setHasLyric(e){this.hasLyric=e,this.requestTick()}getElement(){return this.canvas}dispose(){super.dispose(),this.vertexBuffer.dispose(),this.indexBuffer.dispose(),this.sprites.forEach(e=>e.dispose()),this.copyProgram.dispose(),this.blendProgram.dispose(),this.mainProgram.dispose(),this.fb.forEach(e=>e.dispose()),this.historyFrameBuffer.forEach(e=>e.dispose()),this.tickHandle&&(cancelAnimationFrame(this.tickHandle),this.tickHandle=0)}}class X{element;renderer;constructor(e,i){this.renderer=e,this.element=i,i.style.pointerEvents="none",i.style.zIndex="-1",i.style.contain="strict"}static new(e){const i=document.createElement("canvas");return new X(new e(i),i)}setRenderScale(e){this.renderer.setRenderScale(e)}setFlowSpeed(e){this.renderer.setFlowSpeed(e)}setStaticMode(e){this.renderer.setStaticMode(e)}setFPS(e){this.renderer.setFPS(e)}pause(){this.renderer.pause()}resume(){this.renderer.resume()}setLowFreqVolume(e){this.renderer.setLowFreqVolume(e)}setHasLyric(e){this.renderer.setHasLyric(e)}setAlbumImage(e){return this.renderer.setAlbumImage(e)}getElement(){return this.element}dispose(){this.renderer.dispose(),this.element.remove()}}const ce=(c,e)=>c.size===e.size&&[...c].every(i=>e.has(i));class M{currentPosition=0;targetPosition=0;currentTime=0;params={};currentSolver;getV;getV2;queueParams;queuePosition;constructor(e=0){this.targetPosition=e,this.currentPosition=this.targetPosition,this.currentSolver=()=>this.targetPosition,this.getV=()=>0,this.getV2=()=>0}resetSolver(){const e=this.getV(this.currentTime);this.currentTime=0,this.currentSolver=Ie(this.currentPosition,e,this.targetPosition,0,this.params),this.getV=H(this.currentSolver),this.getV2=H(this.getV)}arrived(){return Math.abs(this.targetPosition-this.currentPosition)<.01&&this.getV(this.currentTime)<.01&&this.getV2(this.currentTime)<.01&&this.queueParams===void 0&&this.queuePosition===void 0}setPosition(e){this.targetPosition=e,this.currentPosition=e,this.currentSolver=()=>this.targetPosition,this.getV=()=>0,this.getV2=()=>0}update(e=0){this.currentTime+=e,this.currentPosition=this.currentSolver(this.currentTime),this.queueParams&&(this.queueParams.time-=e,this.queueParams.time<=0&&this.updateParams({...this.queueParams})),this.queuePosition&&(this.queuePosition.time-=e,this.queuePosition.time<=0&&this.setTargetPosition(this.queuePosition.position)),this.arrived()&&this.setPosition(this.targetPosition)}updateParams(e,i=0){i>0?this.queueParams={...this.queuePosition??{},...e,time:i}:(this.queuePosition=void 0,this.params={...this.params,...e},this.resetSolver())}setTargetPosition(e,i=0){i>0?this.queuePosition={...this.queuePosition??{},position:e,time:i}:(this.queuePosition=void 0,this.targetPosition=e,this.resetSolver())}getCurrentPosition(){return this.currentPosition}}function Ie(c,e,i,t=0,s){const l=s?.soft??!1,r=s?.stiffness??100,n=s?.damping??10,o=s?.mass??1,a=i-c;if(l||1<=n/(2*Math.sqrt(r*o))){const h=-Math.sqrt(r/o),d=-h*a-e;return f=>(f-=t,f<0?c:i-(a+f*d)*Math.E**(f*h))}else{const h=Math.sqrt(4*o*r-n**2),d=(n*a-2*o*e)/h,f=.5*h/o,u=-(.5*n)/o;return I=>(I-=t,I<0?c:i-(Math.cos(I*f)*a+Math.sin(I*f)*d)*Math.E**(I*u))}}function de(c){return i=>(c(i+.001)-c(i-.001))/(2*.001)}function H(c){return de(c)}class me{constructor(e){this.lyricPlayer=e,this.element.setAttribute("class",this.lyricPlayer.style.classes.lyricLine),this.rebuildStyle()}element=document.createElement("div");left=0;top=0;delay=0;lineSize=[0,0];lineTransforms={posX:new M(0),posY:new M(0)};measureSize(){return[this.element.clientWidth,this.element.clientHeight]}lastStyle="";show(){this.rebuildStyle()}hide(){this.rebuildStyle()}rebuildStyle(){let e=`transform:translate(${this.lineTransforms.posX.getCurrentPosition().toFixed(2)}px,${this.lineTransforms.posY.getCurrentPosition().toFixed(2)}px);`;!this.lyricPlayer.getEnableSpring()&&this.isInSight&&(e+=`transition-delay:${this.delay}ms;`),e!==this.lastStyle&&(this.lastStyle=e,this.element.setAttribute("style",e))}getElement(){return this.element}setTransform(e=this.left,i=this.top,t=!1,s=0){this.left=e,this.top=i,this.delay=s*1e3|0,t||!this.lyricPlayer.getEnableSpring()?(t&&this.element.classList.add(this.lyricPlayer.style.classes.tmpDisableTransition),this.lineTransforms.posX.setPosition(e),this.lineTransforms.posY.setPosition(i),this.lyricPlayer.getEnableSpring()?this.rebuildStyle():this.show(),t&&requestAnimationFrame(()=>{this.element.classList.remove(this.lyricPlayer.style.classes.tmpDisableTransition)})):(this.lineTransforms.posX.setTargetPosition(e,s),this.lineTransforms.posY.setTargetPosition(i,s))}update(e=0){this.lyricPlayer.getEnableSpring()&&(this.lineTransforms.posX.update(e),this.lineTransforms.posY.update(e),this.isInSight?this.show():this.hide())}get isInSight(){const e=this.lineTransforms.posX.getCurrentPosition(),i=this.lineTransforms.posY.getCurrentPosition(),t=e+this.lineSize[0],s=i+this.lineSize[1],l=this.lyricPlayer.size[0],r=this.lyricPlayer.size[1];return!(e>l||i>r||t<0||s<0)}dispose(){this.element.remove()}}function fe(c){const i=2.5949095;return c<.5?Math.pow(2*c,2)*((i+1)*2*c-i)/2:(Math.pow(2*c-2,2)*((i+1)*(c*2-2)+i)+2)/2}const T=(c,e,i)=>Math.max(c,Math.min(e,i));class ue{constructor(e){this.lyricPlayer=e,this.element.className=this.lyricPlayer.style.classes.interludeDots,this.element.appendChild(this.dot0),this.element.appendChild(this.dot1),this.element.appendChild(this.dot2)}element=document.createElement("div");dot0=document.createElement("span");dot1=document.createElement("span");dot2=document.createElement("span");left=0;top=0;scale=1;playing=!0;lastStyle="";currentInterlude;currentTime=0;interludeTime=0;targetBreatheDuration=1500;getElement(){return this.element}setTransform(e=this.left,i=this.top){this.left=e,this.top=i,this.update()}setInterlude(e){this.currentInterlude=e,this.currentTime=e?.[0]??0}pause(){this.playing=!1}resume(){this.playing=!0}update(e=0){if(!this.playing)return;this.currentTime+=e;let i="";if(i+=`transform:translate(${this.left.toFixed(2)}px, ${this.top.toFixed(2)}px)`,this.currentInterlude){const t=this.currentInterlude[1]-this.currentInterlude[0],s=this.currentTime-this.currentInterlude[0];if(s<=t){const l=t/Math.ceil(t/this.targetBreatheDuration);let r=1,n=1;r*=Math.sin(1.5*Math.PI-s/l*2)/10+1,s<1e3&&(r*=1-Math.pow((1e3-s)/1e3,2)),s<500?n=0:s<1e3&&(n*=(s-500)/500),t-s<750&&(r*=1-fe((750-(t-s))/750/2)),t-s<375&&(n*=T(0,(t-s)/375,1)),r=Math.max(0,r),i+=` scale(${r})`;const o=T(.25,s*3/t*.75,1),a=T(.25,(s-t/3)*3/t*.75,1),h=T(.25,(s-t/3*2)*3/t*.75,1);this.dot0.style.opacity=`${T(0,Math.max(0,n*o),1)}`,this.dot1.style.opacity=`${T(0,Math.max(0,n*a),1)}`,this.dot2.style.opacity=`${T(0,Math.max(0,n*h),1)}`}else i+=" scale(0)",this.dot0.style.opacity="0",this.dot1.style.opacity="0",this.dot2.style.opacity="0"}else i+=" scale(0)",this.dot0.style.opacity="0",this.dot1.style.opacity="0",this.dot2.style.opacity="0";i+=";",this.lastStyle!==i&&(this.element.setAttribute("style",i),this.lastStyle=i)}dispose(){this.element.remove()}}const pe=/^[\p{Unified_Ideograph}\u0800-\u9FFC]+$/u;function ge(c,e=0,i="rgba(0,0,0,0.85)",t="rgba(0,0,0,0.5)"){const s=2+c+e,l=c/s,r=(1-l)/2;return[`linear-gradient(to right,${i} ${r*100}%,${t} ${(r+l)*100}%)`,l,s]}function ye(c,e){let i=[],t=[];const s=[];for(const l of c){const r=e(l);i.push(r),t.push(l),r.length>0&&r.trim().length===0?(i.pop(),t.pop(),t.length===1?s.push(t[0]):t.length>1&&s.push(t),s.push(l),i=[],t=[]):(!/^\s*[^\s]*\s*$/.test(i.join(""))||pe.test(r))&&(i.pop(),t.pop(),t.length===1?s.push(t[0]):t.length>1&&s.push(t),i=[r],t=[l])}return t.length===1?s.push(t[0]):s.push(t),s}function U(c){return c.endTime-c.startTime>=1e3&&c.word.length<=7}class ve extends MouseEvent{constructor(e,i){super(i.type,i),this.line=e}}class Te extends EventTarget{constructor(e,i={words:[],translatedLyric:"",romanLyric:"",startTime:0,endTime:0,isBG:!1,isDuet:!1}){super(),this.lyricPlayer=e,this.lyricLine=i,this._prevParentEl=e.getElement(),this.element.setAttribute("class",this.lyricPlayer.style.classes.lyricLine),this.lyricLine.isBG&&this.element.classList.add(this.lyricPlayer.style.classes.lyricBgLine),this.lyricLine.isDuet&&this.element.classList.add(this.lyricPlayer.style.classes.lyricDuetLine),this.element.appendChild(document.createElement("div")),this.element.appendChild(document.createElement("div")),this.element.appendChild(document.createElement("div"));const t=this.element.children[0],s=this.element.children[1],l=this.element.children[2];t.setAttribute("class",this.lyricPlayer.style.classes.lyricMainLine),s.setAttribute("class",this.lyricPlayer.style.classes.lyricSubLine),l.setAttribute("class",this.lyricPlayer.style.classes.lyricSubLine),this.rebuildElement(),this.rebuildStyle()}element=document.createElement("div");left=0;top=0;scale=1;blur=0;delay=0;splittedWords=[];lineSize=[0,0];lineTransforms={posX:new M(0),posY:new M(0),scale:new M(1)};listenersMap=new Map;onMouseEvent=e=>{const i=new ve(this,e);for(const t of this.listenersMap.get(e.type)??[])t.call(this,i);if(!this.dispatchEvent(i)||i.defaultPrevented)return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1};addMouseEventListener(e,i,t){if(i){const s=this.listenersMap.get(e)??new Set;s.size===0&&this.element.addEventListener(e,this.onMouseEvent),s.add(i),this.listenersMap.set(e,s)}}removeMouseEventListener(e,i,t){if(i){const s=this.listenersMap.get(e);s&&(s.delete(i),s.size===0&&this.element.removeEventListener(e,this.onMouseEvent))}}isEnabled=!1;enable(){this.isEnabled=!0,this.element.classList.add("active");const e=this.element.children[0];this.splittedWords.forEach(i=>{i.elementAnimations.forEach(t=>{t.currentTime=0,t.playbackRate=1,t.play()})}),e.classList.add("active")}measureSize(){this._hide&&(this._prevParentEl&&this._prevParentEl.appendChild(this.element),this.element.style.display="",this.element.style.visibility="hidden");const e=[this.element.clientWidth,this.element.clientHeight];return this._hide&&(this._prevParentEl&&this.element.remove(),this.element.style.display="none",this.element.style.visibility=""),e}disable(){this.isEnabled=!1,this.element.classList.remove("active");const e=this.element.children[0];this.splittedWords.forEach(i=>{i.elementAnimations.forEach(t=>{t.id==="float-word"&&(t.playbackRate=-1,t.play())})}),e.classList.remove("active")}setLine(e){this.lyricLine=e,this.lyricLine.isBG?this.element.classList.add(this.lyricPlayer.style.classes.lyricBgLine):this.element.classList.remove(this.lyricPlayer.style.classes.lyricBgLine),this.lyricLine.isDuet?this.element.classList.add(this.lyricPlayer.style.classes.lyricDuetLine):this.element.classList.remove(this.lyricPlayer.style.classes.lyricDuetLine),this.rebuildElement(),this.rebuildStyle()}getLine(){return this.lyricLine}_hide=!0;_prevParentEl=null;lastStyle="";show(){this._hide=!1,this._prevParentEl&&(this._prevParentEl.appendChild(this.element),this._prevParentEl=null),this.rebuildStyle()}hide(){this._hide=!0,this.element.parentElement&&(this._prevParentEl=this.element.parentElement,this.element.remove()),this.rebuildStyle()}rebuildStyle(){if(this._hide){this.lastStyle!=="display:none;transform:translate(0,-10000px);"&&(this.lastStyle="display:none;transform:translate(0,-10000px);",this.element.setAttribute("style","display:none;transform:translate(0,-10000px);"));return}let e=`transform:translate(${this.lineTransforms.posX.getCurrentPosition().toFixed(1)}px,${this.lineTransforms.posY.getCurrentPosition().toFixed(1)}px) scale(${this.lineTransforms.scale.getCurrentPosition().toFixed(4)});`;!this.lyricPlayer.getEnableSpring()&&this.isInSight&&(e+=`transition-delay:${this.delay}ms;`),e+=`filter:blur(${Math.min(32,this.blur)}px);`,e!==this.lastStyle&&(this.lastStyle=e,this.element.setAttribute("style",e))}rebuildElement(){const e=this.element.children[0],i=this.element.children[1],t=this.element.children[2];if(this.lyricPlayer._getIsNonDynamic()){e.innerText=this.lyricLine.words.map(l=>l.word).join(""),i.innerText=this.lyricLine.translatedLyric,t.innerText=this.lyricLine.romanLyric;return}const s=ye(this.lyricLine.words,l=>l.word);e.innerHTML="",this.splittedWords=[];for(const l of s)if(l instanceof Array){const r=l.map(a=>U(a)).reduce((a,h)=>a||h,!1),n=l.reduce((a,h)=>(a.endTime=Math.max(a.endTime,h.endTime),a.startTime=Math.min(a.startTime,h.startTime),a.word+=h.word,a),{word:"",startTime:1/0,endTime:-1/0}),o=document.createElement("span");o.classList.add("emphasize-wrapper");for(const a of l){const h=document.createElement("span"),d=this.initFloatAnimation(n,h);if(r){h.classList.add("emphasize");const f=[];for(const I of a.word.trim().split("")){const m=document.createElement("span");m.innerText=I,f.push(m),h.appendChild(m)}const u={...a,mainElement:h,subElements:f,elementAnimations:[],width:0,height:0,shouldEmphasize:r};u.elementAnimations.push(...this.initEmphasizeAnimation(u)),this.splittedWords.push(u)}else h.innerText=a.word,this.splittedWords.push({...a,mainElement:h,subElements:[],elementAnimations:[d],width:0,height:0,shouldEmphasize:r});o.appendChild(h)}n.word.trimStart()!==n.word&&e.appendChild(document.createTextNode(" ")),e.appendChild(o),n.word.trimEnd()!==n.word&&e.appendChild(document.createTextNode(" "))}else if(l.word.trim().length===0)e.appendChild(document.createTextNode(" "));else{const r=U(l),n=document.createElement("span"),o={...l,mainElement:n,subElements:[],elementAnimations:[this.initFloatAnimation(l,n)],width:0,height:0,shouldEmphasize:r};if(r){n.classList.add("emphasize");const a=[];for(const h of l.word.trim().split("")){const d=document.createElement("span");d.innerText=h,a.push(d),n.appendChild(d)}o.subElements=a,o.elementAnimations.push(...this.initEmphasizeAnimation(o))}else n.innerText=l.word.trim();l.word.trimStart()!==l.word&&e.appendChild(document.createTextNode(" ")),e.appendChild(n),l.word.trimEnd()!==l.word&&e.appendChild(document.createTextNode(" ")),this.splittedWords.push(o)}i.innerText=this.lyricLine.translatedLyric,t.innerText=this.lyricLine.romanLyric}initFloatAnimation(e,i){const t=e.startTime-this.lyricLine.startTime,s=Math.max(1e3,e.endTime-e.startTime),l=i.animate([{transform:"translateY(0px)"},{transform:"translateY(-0.05em)"}],{duration:isFinite(s)?s:0,delay:isFinite(t)?t:0,id:"float-word",composite:"add",fill:"both"});return l.pause(),l}initEmphasizeAnimation(e){const i=e.startTime-this.lyricLine.startTime,t=e.endTime-e.startTime;return e.subElements.map((s,l,r)=>{const n=Math.max(1e3,e.endTime-e.startTime),o=i+t/4/r.length*l,a=s.animate([{offset:0,textShadow:"rgba(255, 255, 255, 0) 0 0 0.15em"},{offset:.1,transform:"translateZ(1vw) translateY(-0.05em)",textShadow:"rgba(255, 255, 255, 0.2) 0 0 0.15em"},{offset:.2,textShadow:"rgba(255, 255, 255, 0.3) 0 0 0.15em"},{offset:.5,textShadow:"rgba(255, 255, 255, 0.3) 0 0 0.15em"},{offset:.7,textShadow:"rgba(255, 255, 255, 0.2) 0 0 0.15em"},{offset:1,transform:"translateZ(0vw)",textShadow:"rgba(255, 255, 255, 0.0) 0 0 0.15em"}],{duration:isFinite(n)?n:0,delay:isFinite(o)?o:0,id:"glow-word",iterations:1,composite:"replace",easing:"ease-in",fill:"both"});return a.pause(),a})}updateMaskImage(){this._hide&&(this._prevParentEl&&this._prevParentEl.appendChild(this.element),this.element.style.display="",this.element.style.visibility="hidden"),this.splittedWords.forEach((e,i)=>{const t=e.mainElement;if(t){parseFloat(getComputedStyle(t).paddingInline),e.width=t.clientWidth,e.height=t.clientHeight;const s=e.height/2,[l,r,n]=ge(s/e.width,0,"rgba(0,0,0,0.85)","rgba(0,0,0,0.25)"),o=`${n*100}% 100%`;this.lyricPlayer.supportMaskImage?(t.style.maskImage=l,t.style.maskRepeat="no-repeat",t.style.maskOrigin="left",t.style.maskSize=o):(t.style.webkitMaskImage=l,t.style.webkitMaskRepeat="no-repeat",t.style.webkitMaskOrigin="left",t.style.webkitMaskSize=o);const a=e.width+s,h=`clamp(${-a}px,calc(${-a}px + (var(--amll-player-time) - ${e.startTime})*${a/Math.max(1,Math.abs(e.endTime-e.startTime))}px),0px) 0px, left top`;t.style.maskPosition=h,t.style.webkitMaskPosition=h}}),this._hide&&(this._prevParentEl&&this.element.remove(),this.element.style.display="none",this.element.style.visibility="")}getElement(){return this.element}setTransform(e=this.left,i=this.top,t=this.scale,s=1,l=0,r=!1,n=0){const o=Math.round(l),a=this.isInSight,h=this.lyricPlayer.getEnableSpring();this.left=e,this.top=i,this.scale=t,this.delay=n*1e3|0;const d=this.element.children[0],f=this.element.children[1],u=this.element.children[2];if(d.style.opacity=`${s}`,f.style.opacity=`${s/2}`,u.style.opacity=`${s/2}`,r||!h){if(this.blur=Math.min(32,o),r&&this.element.classList.add(this.lyricPlayer.style.classes.tmpDisableTransition),this.lineTransforms.posX.setPosition(e),this.lineTransforms.posY.setPosition(i),this.lineTransforms.scale.setPosition(t),h)this.rebuildStyle();else{const I=this.isInSight;a||I?this.show():this.hide()}r&&requestAnimationFrame(()=>{this.element.classList.remove(this.lyricPlayer.style.classes.tmpDisableTransition)})}else this.lineTransforms.posX.setTargetPosition(e,n),this.lineTransforms.posY.setTargetPosition(i,n),this.lineTransforms.scale.setTargetPosition(t),this.blur!==Math.min(32,o)&&(this.blur=Math.min(32,o),this.element.style.filter=`blur(${Math.min(32,o)}px)`)}update(e=0){this.lyricPlayer.getEnableSpring()&&(this.lineTransforms.posX.update(e),this.lineTransforms.posY.update(e),this.lineTransforms.scale.update(e),this.isInSight?this.show():this.hide())}_getDebugTargetPos(){return`[位移: ${this.left}, ${this.top}; 缩放: ${this.scale}; 延时: ${this.delay}]`}get isInSight(){const e=this.lineTransforms.posX.getCurrentPosition(),i=this.lineTransforms.posY.getCurrentPosition(),t=e+this.lineSize[0],s=i+this.lineSize[1],l=this.lyricPlayer.size[0],r=this.lyricPlayer.size[1];return!(e>l||t<0||i>r||s<0)}dispose(){this.element.remove()}}const Se=K.create(Z());class be extends MouseEvent{constructor(e,i,t){super(`line-${t.type}`,t),this.lineIndex=e,this.line=i}}class xe extends EventTarget{element=document.createElement("div");currentTime=0;lyricLines=[];processedLines=[];lyricLinesEl=[];lyricLinesSize=new WeakMap;lyricLinesIndexes=new WeakMap;hotLines=new Set;bufferedLines=new Set;scrollToIndex=0;allowScroll=!0;scrolledHandler=0;isScrolled=!1;invokedByScrollEvent=!1;scrollOffset=0;hidePassedLines=!1;resizeObserver=new ResizeObserver(e=>{const i=e[0].contentRect;this.size[0]=i.width,this.size[1]=i.height;const t=getComputedStyle(e[0].target),s=this.element.clientWidth-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight),l=this.element.clientHeight-parseFloat(t.paddingTop)-parseFloat(t.paddingBottom);this.innerSize[0]=s,this.innerSize[1]=l,this.rebuildStyle(),this.calcLayout(!0,!0),this.lyricLinesEl.forEach(r=>r.updateMaskImage())});posXSpringParams={mass:1,damping:10,stiffness:100};posYSpringParams={mass:1,damping:16.5,stiffness:100};scaleSpringParams={mass:1,damping:20,stiffness:100};emUnit=Math.max(Math.min(innerHeight*.05,innerWidth*.1),12);padding=this.emUnit;enableBlur=!0;enableScale=!0;interludeDots;interludeDotsSize=[0,0];bottomLine;supportPlusLighter=CSS.supports("mix-blend-mode","plus-lighter");supportMaskImage=CSS.supports("mask-image","none");disableSpring=!1;alignAnchor="center";alignPosition=.5;isNonDynamic=!1;scrollBoundary=[0,0];size=[0,0];innerSize=[0,0];onLineClickedHandler=e=>{const i=new be(this.lyricLinesIndexes.get(e.line)??-1,e.line,e);this.dispatchEvent(i)||(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation())};_getIsNonDynamic(){return this.isNonDynamic}setEnableSpring(e=!0){this.disableSpring=!e,e?this.element.classList.remove(this.style.classes.disableSpring):this.element.classList.add(this.style.classes.disableSpring),this.calcLayout(!0)}getEnableSpring(){return!this.disableSpring}setEnableScale(e=!0){this.enableScale=e,this.calcLayout()}getEnableScale(){return this.enableScale}style=Se.createStyleSheet({lyricPlayer:{userSelect:"none",fontSize:"var(--amll-lyric-player-font-size,max(min(5vh, 10vw), 12px))",padding:"1em",margin:"-1em",width:"100%",height:"100%",overflow:"hidden",boxSizing:"content-box",maxWidth:"100%",maxHeight:"100%",zIndex:1,color:"var(--amll-lyric-view-color,white)",mixBlendMode:"plus-lighter",contain:"strict","&:hover":{"& $lyricLine":{filter:"unset !important"}}},lyricLine:{position:"absolute",backfaceVisibility:"hidden",transformOrigin:"left",width:"var(--amll-lyric-player-width,100%)",height:"fit-content",padding:"2vh 1.05em",margin:"0 -1em",contain:"content",willChange:"filter,transform,opacity",transition:"filter 0.25s, background-color 0.25s, box-shadow 0.25s",boxSizing:"content-box",borderRadius:"8px","&:has(>*):hover":{backgroundColor:"var(--amll-lyric-view-hover-bg-color,#fff1)",boxShadow:"0 0 0 8px var(--amll-lyric-view-hover-bg-color,#fff1)"},"&:has(>*):active":{boxShadow:"0 0 0 4px var(--amll-lyric-view-hover-bg-color,#fff1)"}},"@media (max-width: 1024px)":{lyricLine:{padding:"1vh 1em"}},lyricDuetLine:{textAlign:"right",transformOrigin:"right"},lyricBgLine:{opacity:0,fontSize:"max(50%, 10px)",transition:"opacity 0.25s","&.active":{transition:"opacity 0.25s 0.25s",opacity:.4}},lyricMainLine:{transition:"opacity 0.3s 0.25s",willChange:"opacity",margin:"-1em",padding:"1em","& span":{display:"inline-block"},"& > span, span.emphasize-wrapper":{whiteSpace:"pre-wrap",maxLines:"1",willChange:"transform,display,mask-image","&.emphasize, span.emphasize":{transformStyle:"preserve-3d",perspective:"min(50vw, 50vh)",padding:"1em",margin:"-1em","& > span":{padding:"1em",margin:"-1em"}}}},lyricSubLine:{fontSize:"max(0.5em, 10px)",transition:"opacity 0.3s 0.25s",opacity:.3},disableSpring:{"& > *":{transition:"filter 0.25s, transform 0.5s, background-color 0.25s, box-shadow 0.25s"}},interludeDots:{height:"clamp(0.5em,1vh,3em)",transformOrigin:"center",width:"fit-content",padding:"2.5% 0",position:"absolute",display:"flex",gap:"0.25em",left:"1em","& > *":{height:"clamp(0.5em,1vh,3em)",display:"inline-block",borderRadius:"50%",aspectRatio:"1 / 1",backgroundColor:"var(--amll-lyric-view-color,white)",marginRight:"4px"},"&.duet":{right:"1em",transformOrigin:"center"}},"@supports (mix-blend-mode: plus-lighter)":{lyricSubLine:{opacity:.3}},tmpDisableTransition:{transition:"none !important"}});onPageShow=()=>{this.calcLayout(!0,!0)};constructor(){super(),this.interludeDots=new ue(this),this.bottomLine=new me(this),this.element.setAttribute("class",this.style.classes.lyricPlayer),this.disableSpring&&this.element.classList.add(this.style.classes.disableSpring),this.rebuildStyle(),this.resizeObserver.observe(this.element),this.element.appendChild(this.interludeDots.getElement()),this.element.appendChild(this.bottomLine.getElement()),this.style.attach(),this.interludeDots.setTransform(0,200),window.addEventListener("pageshow",this.onPageShow);let e=0,i="none",t=0,s=0,l=0,r=Symbol("amll-scroll"),n=0,o=0;this.element.addEventListener("touchstart",a=>{this.beginScrollHandler()&&(a.preventDefault(),e=this.scrollOffset,t=a.touches[0].screenY,n=t,s=Date.now(),l=0)}),this.element.addEventListener("touchmove",a=>{if(this.beginScrollHandler()){a.preventDefault();const h=a.touches[0].screenY,d=h-t,f=h-n,u=f>0?"down":f<0?"up":"none";i!==u?(i=u,e=this.scrollOffset,t=h,s=Date.now()):this.scrollOffset=e-d,n=h,o=Date.now(),this.limitScrollOffset(),this.calcLayout(!0)}}),this.element.addEventListener("touchend",a=>{if(this.beginScrollHandler()){a.preventDefault(),t=0;const h=Date.now();if(h-o>100)return this.endScrollHandler();const d=h-s;l=(this.scrollOffset-e)/d*1e3;let f=0;const u=Symbol("amll-scroll");r=u;const I=m=>{f||=m,r===u&&this.beginScrollHandler()&&(this.scrollOffset+=l*(m-f)/1e3,l*=.99,this.limitScrollOffset(),this.calcLayout(!0),Math.abs(l)>1&&!this.scrollBoundary.includes(this.scrollOffset)&&requestAnimationFrame(I),this.endScrollHandler(),f=m)};requestAnimationFrame(I),this.endScrollHandler()}}),this.element.addEventListener("wheel",a=>{this.beginScrollHandler()&&(a.deltaMode===a.DOM_DELTA_PIXEL?(this.scrollOffset+=a.deltaY,this.limitScrollOffset(),this.calcLayout(!0)):(this.scrollOffset+=a.deltaY*50,this.limitScrollOffset(),this.calcLayout(!1)),this.endScrollHandler())})}beginScrollHandler(){const e=this.allowScroll;return e&&(this.isScrolled=!0,this.invokedByScrollEvent=!0,clearTimeout(this.scrolledHandler),this.scrolledHandler=setTimeout(()=>{this.isScrolled=!1,this.scrollOffset=0},5e3)),e}endScrollHandler(){this.invokedByScrollEvent=!1}limitScrollOffset(){this.scrollOffset=Math.max(Math.min(this.scrollBoundary[1],this.scrollOffset),this.scrollBoundary[0])}getCurrentInterlude(){if(this.bufferedLines.size>0)return;const e=this.currentTime+20,i=this.scrollToIndex;if(i===0){if(this.processedLines[0]?.startTime&&this.processedLines[0].startTime>e)return[e,Math.max(e,this.processedLines[0].startTime-250),-2,this.processedLines[0].isDuet]}else if(this.processedLines[i]?.endTime&&this.processedLines[i+1]?.startTime&&this.processedLines[i+1].startTime>e&&this.processedLines[i].endTime<e)return[Math.max(this.processedLines[i].endTime,e),this.processedLines[i+1].startTime,i,this.processedLines[i+1].isDuet]}rebuildStyle(){let e="";e+="--amll-lyric-player-width:",e+=this.innerSize[0]-this.padding*2,e+="px;",e+="--amll-lyric-player-height:",e+=this.innerSize[1]-this.padding*2,e+="px;",this.element.setAttribute("style",e)}setHidePassedLines(e){this.hidePassedLines=e,this.calcLayout()}setEnableBlur(e){this.enableBlur!==e&&(this.enableBlur=e,this.calcLayout())}setLyricLines(e){e.forEach(t=>{t.words.forEach(s=>{s.word=s.word.replace(/\s+/g," ")})}),this.lyricLines=e;const i=750;this.processedLines=e.filter(t=>t.words.reduce((s,l)=>s+l.word.trim().length,0)>0).map((t,s,l)=>{if(t.isBG)return{...t};if(s===0)return{...t,startTime:Math.max(t.startTime-i,0)};{const r=l[s-1],n=l[s-2];if(r?.isBG&&n){if(n.endTime<t.startTime)return{...t,startTime:Math.max(n.endTime,t.startTime-i)||t.startTime}}else if(r?.endTime&&r.endTime<t.startTime)return{...t,startTime:Math.max(r?.endTime,t.startTime-i)||t.startTime};return{...t}}}),this.isNonDynamic=!0;for(const t of this.processedLines)if(t.words.length>1){this.isNonDynamic=!1;break}this.processedLines.forEach((t,s,l)=>{const r=l[s+1],n=t.words[t.words.length-1];n&&U(n)&&(r?r.startTime>t.endTime&&(t.endTime=Math.min(t.endTime+1500,r.startTime)):t.endTime=t.endTime+1500)}),this.processedLines.forEach((t,s,l)=>{if(t.isBG)return;const r=l[s+1];r?.isBG&&(r.startTime=Math.min(r.startTime,t.startTime))}),this.lyricLinesEl.forEach(t=>{t.removeMouseEventListener("click",this.onLineClickedHandler),t.removeMouseEventListener("contextmenu",this.onLineClickedHandler),t.dispose()}),this.lyricLinesEl=this.processedLines.map(t=>{const s=new Te(this,t);return s.addMouseEventListener("click",this.onLineClickedHandler),s.addMouseEventListener("contextmenu",this.onLineClickedHandler),s}),this.lyricLinesEl.forEach((t,s)=>{this.element.appendChild(t.getElement()),this.lyricLinesIndexes.set(t,s),t.updateMaskImage()}),this.interludeDots.setInterlude(void 0),this.hotLines.clear(),this.bufferedLines.clear(),this.setLinePosXSpringParams({}),this.setLinePosYSpringParams({}),this.setLineScaleSpringParams({}),this.setCurrentTime(0,!0),this.calcLayout(!0,!0)}resetScroll(){this.isScrolled=!1,this.scrollOffset=0,this.invokedByScrollEvent=!1,clearTimeout(this.scrolledHandler),this.scrolledHandler=0}calcLayout(e=!1,i=!1){i&&(this.emUnit=parseFloat(getComputedStyle(this.element).fontSize),this.lyricLinesEl.forEach(I=>{const m=I.measureSize();this.lyricLinesSize.set(I,m),I.lineSize=m}),this.interludeDotsSize[0]=this.interludeDots.getElement().clientWidth,this.interludeDotsSize[1]=this.interludeDots.getElement().clientHeight,this.bottomLine.lineSize=this.bottomLine.measureSize());const t=this.getCurrentInterlude();let s=-this.scrollOffset,l=this.scrollToIndex,r=0;t?(r=t[1]-t[0],r>=5e3&&this.lyricLinesEl[t[2]+1]&&(l=t[2]+1)):this.interludeDots.setInterlude(void 0);const n=this.enableScale?.95:1,o=this.lyricLinesEl.slice(0,l).reduce((I,m)=>I+(m.getLine().isBG?0:this.lyricLinesSize.get(m)?.[1]??0),0);this.scrollBoundary[0]=-o,s-=o,s+=this.size[1]*this.alignPosition;const a=this.lyricLinesEl[l];if(a){const I=this.lyricLinesSize.get(a)?.[1]??0;switch(this.alignAnchor){case"bottom":s-=I;break;case"center":s-=I/2;break}}const h=Math.max(...this.bufferedLines);let d=0,f=.05,u=!1;this.lyricLinesEl.forEach((I,m)=>{const g=this.bufferedLines.has(m),p=g||m>=this.scrollToIndex&&m<h,y=I.getLine();y.isDuet&&this.size[0]-(this.lyricLinesSize.get(I)?.[0]??0),!u&&r>=5e3&&(m===this.scrollToIndex&&t?.[2]===-2||m===this.scrollToIndex+1)&&(u=!0,this.interludeDots.setTransform(this.padding,s+12),t&&this.interludeDots.setInterlude([t[0],t[1]]),s+=this.interludeDotsSize[1]+40);const x=this.hidePassedLines&&m<(t?t[2]+1:this.scrollToIndex)?0:g?1:1/3;I.setTransform(this.padding,s,p?1:n,x,!this.invokedByScrollEvent&&this.enableBlur?p?0:1+(m<this.scrollToIndex?Math.abs(this.scrollToIndex-m):Math.abs(m-Math.max(this.scrollToIndex,h))):0,e,d),y.isBG&&p?s+=this.lyricLinesSize.get(I)?.[1]??0:y.isBG||(s+=this.lyricLinesSize.get(I)?.[1]??0),s>=0&&(d+=f,f/=1.2)}),this.scrollBoundary[1]=s+this.scrollOffset-this.size[1]/2,this.bottomLine.setTransform(this.padding,s,e,d)}getCurrentTime(){return this.currentTime}getLyricLines(){return this.lyricLines}getElement(){return this.element}getBottomLineElement(){return this.bottomLine.getElement()}setAlignAnchor(e){this.alignAnchor=e}setAlignPosition(e){this.alignPosition=e}setCurrentTime(e,i=!1){if(this.currentTime=e,this._getIsNonDynamic()||this.element.style.setProperty("--amll-player-time",`${e}`),this.isScrolled)return;const t=new Set,s=new Set,l=new Set;this.hotLines.forEach(r=>{const n=this.processedLines[r];if(n){if(n.isBG)return;const o=this.processedLines[r+1];if(o?.isBG){const a=this.processedLines[r+2],h=Math.min(n.startTime,o?.startTime),d=Math.min(Math.max(n.endTime,a?.startTime??Number.MAX_VALUE),Math.max(n.endTime,o?.endTime));(h>e||d<=e)&&(this.hotLines.delete(r),t.add(r),this.hotLines.delete(r+1),t.add(r+1),i&&(this.lyricLinesEl[r].disable(),this.lyricLinesEl[r+1].disable()))}else(n.startTime>e||n.endTime<=e)&&(this.hotLines.delete(r),t.add(r),i&&this.lyricLinesEl[r].disable())}else this.hotLines.delete(r),t.add(r),i&&this.lyricLinesEl[r].disable()}),this.processedLines.forEach((r,n,o)=>{!r.isBG&&r.startTime<=e&&r.endTime>e&&(this.hotLines.has(n)||(this.hotLines.add(n),l.add(n),i&&this.lyricLinesEl[n].enable(),o[n+1]?.isBG&&(this.hotLines.add(n+1),l.add(n+1),i&&this.lyricLinesEl[n+1].enable())))}),this.bufferedLines.forEach(r=>{this.hotLines.has(r)||(s.add(r),i&&this.lyricLinesEl[r].disable())}),i?(this.bufferedLines.size>0?this.scrollToIndex=Math.min(...this.bufferedLines):this.scrollToIndex=this.processedLines.findIndex(r=>r.startTime>=e),this.bufferedLines.clear(),this.hotLines.forEach(r=>this.bufferedLines.add(r)),this.calcLayout(!0)):(s.size>0||l.size>0)&&(s.size===0&&l.size>0?(l.forEach(r=>{this.bufferedLines.add(r),this.lyricLinesEl[r].enable()}),this.scrollToIndex=Math.min(...this.bufferedLines),this.calcLayout()):l.size===0&&s.size>0?ce(s,this.bufferedLines)&&(this.bufferedLines.forEach(r=>{this.hotLines.has(r)||(this.bufferedLines.delete(r),this.lyricLinesEl[r].disable())}),this.calcLayout()):(l.forEach(r=>{this.bufferedLines.add(r),this.lyricLinesEl[r].enable()}),s.forEach(r=>{this.bufferedLines.delete(r),this.lyricLinesEl[r].disable()}),this.bufferedLines.size>0&&(this.scrollToIndex=Math.min(...this.bufferedLines)),this.calcLayout()))}pause(){this.interludeDots.pause()}resume(){this.interludeDots.resume()}update(e=0){const i=e/1e3;this.interludeDots.update(e),this.bottomLine.update(i),this.lyricLinesEl.forEach(t=>t.update(i))}setLinePosXSpringParams(e){this.posXSpringParams={...this.posXSpringParams,...e},this.bottomLine.lineTransforms.posX.updateParams(this.posXSpringParams),this.lyricLinesEl.forEach(i=>i.lineTransforms.posX.updateParams(this.posXSpringParams))}setLinePosYSpringParams(e){this.posYSpringParams={...this.posYSpringParams,...e},this.bottomLine.lineTransforms.posY.updateParams(this.posYSpringParams),this.lyricLinesEl.forEach(i=>i.lineTransforms.posY.updateParams(this.posYSpringParams))}setLineScaleSpringParams(e){this.scaleSpringParams={...this.scaleSpringParams,...e},this.lyricLinesEl.forEach(i=>i.lineTransforms.scale.updateParams(this.scaleSpringParams))}dispose(){this.element.remove(),this.resizeObserver.disconnect(),this.style.detach(),this.lyricLinesEl.forEach(e=>e.dispose()),window.removeEventListener("pageshow",this.onPageShow),this.bottomLine.dispose(),this.interludeDots.dispose()}}exports.AbstractBaseRenderer=W;exports.BackgroundRender=X;exports.BaseRenderer=q;exports.EplorRenderer=D;exports.LyricPlayer=xe;exports.PixiRenderer=ee;
//# sourceMappingURL=amll-core.cjs.map
